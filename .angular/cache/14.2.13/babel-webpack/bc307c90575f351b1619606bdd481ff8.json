{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { concatMap, tap } from 'rxjs/operators';\nimport Chart from 'chart.js';\nimport * as _ from 'lodash';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./../core/service/shareholding.service\";\nimport * as i2 from \"./../core/service/stock.service\";\nimport * as i3 from \"./../core/service/loading.service\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"ngx-bootstrap/modal\";\n\nfunction ShareholdingDetailsComponent_h1_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\", 27);\n    i0.ɵɵtext(1, \"\\u7121\\u6301\\u80A1\\u660E\\u7D30\\uFF0C\\u8ACB\\u65B0\\u589E\\u3002\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ShareholdingDetailsComponent_div_9_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 34);\n    i0.ɵɵlistener(\"click\", function ShareholdingDetailsComponent_div_9_button_10_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.switchDisplayMode(\"sum\"));\n    });\n    i0.ɵɵtext(1, \"\\u986F\\u793A\\u7E3D\\u89BD\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ShareholdingDetailsComponent_div_9_button_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 34);\n    i0.ɵɵlistener(\"click\", function ShareholdingDetailsComponent_div_9_button_11_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r10.switchDisplayMode(\"detail\"));\n    });\n    i0.ɵɵtext(1, \"\\u986F\\u793A\\u660E\\u7D30\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ShareholdingDetailsComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 0)(1, \"select\", 28);\n    i0.ɵɵlistener(\"ngModelChange\", function ShareholdingDetailsComponent_div_9_Template_select_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.selectedSortOption = $event);\n    })(\"ngModelChange\", function ShareholdingDetailsComponent_div_9_Template_select_ngModelChange_1_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.sortColumn());\n    });\n    i0.ɵɵelementStart(2, \"option\", 29);\n    i0.ɵɵtext(3, \"\\u4EA4\\u6613\\u65E5\\u671F \\u2191\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"option\", 30);\n    i0.ɵɵtext(5, \"\\u4EA4\\u6613\\u65E5\\u671F \\u2193\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"option\", 31);\n    i0.ɵɵtext(7, \"\\u80A1\\u7968\\u4EE3\\u865F \\u2191\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"option\", 32);\n    i0.ɵɵtext(9, \"\\u80A1\\u7968\\u4EE3\\u865F \\u2193\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(10, ShareholdingDetailsComponent_div_9_button_10_Template, 2, 0, \"button\", 33);\n    i0.ɵɵtemplate(11, ShareholdingDetailsComponent_div_9_button_11_Template, 2, 0, \"button\", 33);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.selectedSortOption);\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.displayMode === \"detail\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.displayMode === \"sum\");\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_10_tr_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const detail_r16 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detail_r16.stockId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(5, 3, detail_r16.stockUnits));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(8, 5, detail_r16.cost));\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 35)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"\\u80A1\\u7968\\u4EE3\\u865F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"\\u7E3D\\u80A1\\u6578\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"\\u7E3D\\u6210\\u672C\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(9, \"tbody\", 36);\n    i0.ɵɵtemplate(10, ShareholdingDetailsComponent_table_10_tr_10_Template, 9, 7, \"tr\", 37);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.shareHoldingSum);\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 38);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(detail_r18.stockId);\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r33 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 38)(1, \"input\", 43);\n    i0.ɵɵlistener(\"ngModelChange\", function ShareholdingDetailsComponent_table_11_tr_18_td_2_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r33);\n      const detail_r18 = i0.ɵɵnextContext().$implicit;\n      return i0.ɵɵresetView(detail_r18.stockId = $event);\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", detail_r18.stockId);\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 38);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, detail_r18.stockUnits));\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r38 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 38)(1, \"input\", 44);\n    i0.ɵɵlistener(\"ngModelChange\", function ShareholdingDetailsComponent_table_11_tr_18_td_4_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r38);\n      const detail_r18 = i0.ɵɵnextContext().$implicit;\n      return i0.ɵɵresetView(detail_r18.stockUnits = $event);\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", detail_r18.stockUnits);\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 38);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, detail_r18.dealPrice));\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r43 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 38)(1, \"input\", 44);\n    i0.ɵɵlistener(\"ngModelChange\", function ShareholdingDetailsComponent_table_11_tr_18_td_6_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r43);\n      const detail_r18 = i0.ɵɵnextContext().$implicit;\n      return i0.ɵɵresetView(detail_r18.dealPrice = $event);\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", detail_r18.dealPrice);\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 38);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(detail_r18.date);\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r48 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 38)(1, \"input\", 45);\n    i0.ɵɵlistener(\"ngModelChange\", function ShareholdingDetailsComponent_table_11_tr_18_td_11_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r48);\n      const detail_r18 = i0.ɵɵnextContext().$implicit;\n      return i0.ɵɵresetView(detail_r18.date = $event);\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", detail_r18.date);\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r52 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 39)(1, \"i\", 46);\n    i0.ɵɵlistener(\"click\", function ShareholdingDetailsComponent_table_11_tr_18_td_12_Template_i_click_1_listener() {\n      i0.ɵɵrestoreView(_r52);\n      const i_r19 = i0.ɵɵnextContext().index;\n      const ctx_r50 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r50.startEditShareHoldingDetail(i_r19));\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_td_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r54 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 39)(1, \"i\", 47);\n    i0.ɵɵlistener(\"click\", function ShareholdingDetailsComponent_table_11_tr_18_td_13_Template_i_click_1_listener() {\n      i0.ɵɵrestoreView(_r54);\n      const ctx_r53 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r53.endEditShareHoldingDetail());\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_tr_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r56 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵtemplate(1, ShareholdingDetailsComponent_table_11_tr_18_td_1_Template, 2, 1, \"td\", 40);\n    i0.ɵɵtemplate(2, ShareholdingDetailsComponent_table_11_tr_18_td_2_Template, 2, 1, \"td\", 40);\n    i0.ɵɵtemplate(3, ShareholdingDetailsComponent_table_11_tr_18_td_3_Template, 3, 3, \"td\", 40);\n    i0.ɵɵtemplate(4, ShareholdingDetailsComponent_table_11_tr_18_td_4_Template, 2, 1, \"td\", 40);\n    i0.ɵɵtemplate(5, ShareholdingDetailsComponent_table_11_tr_18_td_5_Template, 3, 3, \"td\", 40);\n    i0.ɵɵtemplate(6, ShareholdingDetailsComponent_table_11_tr_18_td_6_Template, 2, 1, \"td\", 40);\n    i0.ɵɵelementStart(7, \"td\", 38);\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, ShareholdingDetailsComponent_table_11_tr_18_td_10_Template, 2, 1, \"td\", 40);\n    i0.ɵɵtemplate(11, ShareholdingDetailsComponent_table_11_tr_18_td_11_Template, 2, 1, \"td\", 40);\n    i0.ɵɵtemplate(12, ShareholdingDetailsComponent_table_11_tr_18_td_12_Template, 2, 0, \"td\", 41);\n    i0.ɵɵtemplate(13, ShareholdingDetailsComponent_table_11_tr_18_td_13_Template, 2, 0, \"td\", 41);\n    i0.ɵɵelementStart(14, \"td\", 39)(15, \"i\", 42);\n    i0.ɵɵlistener(\"click\", function ShareholdingDetailsComponent_table_11_tr_18_Template_i_click_15_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r56);\n      const detail_r18 = restoredCtx.$implicit;\n      const ctx_r55 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r55.deleteShareHoldingDetail(detail_r18.id));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const detail_r18 = ctx.$implicit;\n    const i_r19 = ctx.index;\n    const ctx_r17 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex !== i_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex === i_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex !== i_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex === i_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex !== i_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex === i_r19);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(9, 11, detail_r18.stockUnits * detail_r18.dealPrice));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex !== i_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex === i_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex !== i_r19 && !ctx_r17.editItem);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r17.editIndex === i_r19);\n  }\n}\n\nfunction ShareholdingDetailsComponent_table_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 35)(1, \"thead\")(2, \"tr\")(3, \"th\", 38);\n    i0.ɵɵtext(4, \"\\u80A1\\u7968\\u4EE3\\u865F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\", 38);\n    i0.ɵɵtext(6, \"\\u80A1\\u6578\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\", 38);\n    i0.ɵɵtext(8, \"\\u80A1\\u50F9\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\", 38);\n    i0.ɵɵtext(10, \"\\u6210\\u672C\\u50F9\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\", 38);\n    i0.ɵɵtext(12, \"\\u4EA4\\u6613\\u65E5\\u671F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\", 39);\n    i0.ɵɵtext(14, \"\\u7DE8\\u8F2F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"th\", 39);\n    i0.ɵɵtext(16, \"\\u522A\\u9664\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(17, \"tbody\", 36);\n    i0.ɵɵtemplate(18, ShareholdingDetailsComponent_table_11_tr_18_Template, 16, 13, \"tr\", 37);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(18);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.shareHoldingDetail);\n  }\n}\n\nfunction ShareholdingDetailsComponent_option_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 48);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const stockInfo_r57 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"value\", stockInfo_r57.stock_id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", stockInfo_r57.stock_id, \" \", stockInfo_r57.stock_name, \"\");\n  }\n}\n\nexport let ShareholdingDetailsComponent = /*#__PURE__*/(() => {\n  class ShareholdingDetailsComponent {\n    constructor(shareholdingService, stockService, loadingService, fb) {\n      this.shareholdingService = shareholdingService;\n      this.stockService = stockService;\n      this.loadingService = loadingService;\n      this.fb = fb;\n      this.shareHoldingDetail = [];\n      this.displayMode = 'sum';\n      this.selectedSortOption = 'dateDrop';\n      this.sortStatus = {\n        stockId: true,\n        date: false\n      };\n    } // 加載中\n\n\n    get isLoading() {\n      return this.loadingService.isLoading;\n    }\n\n    get shareHoldingSum() {\n      const result = [];\n      this.shareHoldingDetail.forEach(detail => {\n        const existingDetail = result.find(r => r.stockId === detail.stockId);\n\n        if (existingDetail) {\n          existingDetail.cost += detail.dealPrice * detail.stockUnits;\n          existingDetail.stockUnits += detail.stockUnits;\n        } else {\n          result.push({\n            stockId: detail.stockId,\n            stockUnits: detail.stockUnits,\n            cost: detail.dealPrice * detail.stockUnits\n          });\n        }\n      });\n      return result;\n    }\n\n    ngOnInit() {\n      this.buildForm();\n      this.loadingService.show();\n      this.shareholdingService.getShareholding().pipe(tap(res => {\n        if (res.length > 0) {\n          this.shareHoldingDetail = res;\n          this.calcTotalAmount();\n          this.drawChart();\n          this.sortColumn();\n        }\n\n        this.loadingService.hide();\n      })).subscribe();\n    }\n\n    buildForm() {\n      this.form = this.fb.group({\n        stockId: ['', Validators.required],\n        date: ['', Validators.required],\n        stockUnits: ['', [Validators.required, Validators.min(1)]],\n        dealPrice: ['', [Validators.required, Validators.min(1)]]\n      });\n    }\n\n    startAddShareholding() {\n      this.form.reset();\n\n      if (!this.stocksInfo) {\n        this.loadingService.show();\n        this.stockService.getTaiwanStockInfo().subscribe(res => {\n          this.stocksInfo = res.data;\n          this.loadingService.hide();\n        });\n      }\n    }\n\n    onAddShareholdingSubmit(req) {\n      this.shareholdingService.addShareholding(req).pipe(concatMap(() => this.shareholdingService.getShareholding()), tap(res => this.shareHoldingDetail = res)).subscribe(() => {\n        this.calcTotalAmount();\n        this.drawChart();\n      });\n    }\n\n    calcTotalAmount() {\n      this.totalAcount = this.shareHoldingDetail.map(detail => detail.dealPrice * detail.stockUnits).reduce((a, b) => a + b, 0);\n    }\n\n    drawChart() {\n      const canvas = document.getElementById('chart');\n\n      if (this.chart) {\n        this.chart.destroy();\n      }\n\n      if (canvas) {\n        const ctx = canvas.getContext('2d');\n        const colors = ['#F43545', '#FF8901', '#FAD717', '#00BA71', '#00C2DE', '#00418D', '#5F2879'];\n        const backgroundColors = [];\n        this.shareHoldingSum.forEach((r, i) => {\n          const color = colors[i % colors.length];\n          backgroundColors.push(color);\n        });\n        this.chart = new Chart(ctx, {\n          type: 'doughnut',\n          data: {\n            labels: this.shareHoldingSum.map(r => r.stockId),\n            datasets: [{\n              data: this.shareHoldingSum.map(r => r.cost),\n              backgroundColor: backgroundColors,\n              hoverBackgroundColor: backgroundColors\n            }]\n          },\n          options: {\n            responsive: true,\n            legend: {\n              position: 'left'\n            }\n          }\n        });\n      }\n    }\n\n    switchDisplayMode(mode) {\n      this.displayMode = mode;\n    }\n\n    sortColumn() {\n      switch (this.selectedSortOption) {\n        case 'stockIdRise':\n          this.shareHoldingDetail.sort((a, b) => a.stockId.localeCompare(b.stockId));\n          break;\n\n        case 'stockIdDrop':\n          this.shareHoldingDetail.sort((a, b) => b.stockId.localeCompare(a.stockId));\n          break;\n\n        case 'dateRise':\n          this.shareHoldingDetail.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n          break;\n\n        case 'dateDrop':\n          this.shareHoldingDetail.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n          break;\n\n        default:\n          // 預設排序方式\n          break;\n      }\n    }\n\n    startEditShareHoldingDetail(index) {\n      this.editItem = this.shareHoldingDetail[index];\n      this.editIndex = index;\n      this.cloneShareHoldingDetail = _.cloneDeep(this.shareHoldingDetail);\n    }\n\n    endEditShareHoldingDetail() {\n      this.editItem = null;\n      this.editIndex = -1;\n\n      if (!_.isEqual(this.shareHoldingDetail, this.cloneShareHoldingDetail)) {\n        const req = {};\n        this.shareHoldingDetail.map(item => {\n          req[item.id] = {\n            date: item.date,\n            dealPrice: item.dealPrice,\n            stockId: item.stockId,\n            stockUnits: item.stockUnits\n          };\n        });\n        this.shareholdingService.updateShareholding(req).subscribe(() => {\n          this.calcTotalAmount();\n          this.drawChart();\n        });\n      }\n\n      ;\n    }\n\n    deleteShareHoldingDetail(id) {\n      this.loadingService.show();\n      this.shareholdingService.deleteShareholding(id).subscribe(() => {\n        this.loadingService.hide();\n        this.shareHoldingDetail = this.shareHoldingDetail.filter(res => res.id !== id);\n        this.calcTotalAmount();\n        this.drawChart();\n      });\n    }\n\n  }\n\n  ShareholdingDetailsComponent.ɵfac = function ShareholdingDetailsComponent_Factory(t) {\n    return new (t || ShareholdingDetailsComponent)(i0.ɵɵdirectiveInject(i1.ShareholdingService), i0.ɵɵdirectiveInject(i2.StockService), i0.ɵɵdirectiveInject(i3.LoadingService), i0.ɵɵdirectiveInject(i4.UntypedFormBuilder));\n  };\n\n  ShareholdingDetailsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ShareholdingDetailsComponent,\n    selectors: [[\"app-shareholding-details\"]],\n    decls: 48,\n    vars: 12,\n    consts: [[1, \"row\", \"mt-5\"], [\"id\", \"chart\", 1, \"col-md-6\"], [1, \"col-md-6\", \"d-flex\", \"flex-column\", \"justify-content-center\"], [1, \"btn\", \"mt-5\", \"add-btn\", 3, \"click\"], [\"class\", \"mt-5\", 4, \"ngIf\"], [\"class\", \"row mt-5\", 4, \"ngIf\"], [\"class\", \"table table-fixed table-hover mt-5 mb-5\", 4, \"ngIf\"], [\"bsModal\", \"\", \"tabindex\", \"-1\", \"role\", \"dialog\", \"aria-labelledby\", \"dialog-sizes-name2\", 1, \"modal\", \"fade\"], [\"addShareholding\", \"bs-modal\"], [1, \"modal-dialog\"], [1, \"modal-content\"], [1, \"modal-header\"], [\"id\", \"dialog-sizes-name2\", 1, \"modal-title\", \"pull-left\"], [\"type\", \"button\", \"aria-label\", \"Close\", 1, \"close\", \"pull-right\", 3, \"click\"], [\"aria-hidden\", \"true\"], [1, \"modal-body\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"input-group\", \"mb-3\"], [1, \"input-group-prepend\"], [\"id\", \"basic-addon1\", 1, \"input-group-text\"], [\"type\", \"text\", \"placeholder\", \"\\u8ACB\\u9078\\u64C7\\u80A1\\u7968\\u4EE3\\u865F\", \"list\", \"stockId\", \"autocomplete\", \"off\", \"formControlName\", \"stockId\", \"maxlength\", \"6\", 1, \"form-control\"], [\"id\", \"stockId\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"date\", \"placeholder\", \"\\u8ACB\\u9078\\u64C7\\u4EA4\\u6613\\u65E5\\u671F\", \"formControlName\", \"date\", 1, \"form-control\"], [\"type\", \"number\", \"placeholder\", \"\\u8ACB\\u8F38\\u5165\\u80A1\\u6578\", \"formControlName\", \"stockUnits\", \"maxlength\", \"8\", 1, \"form-control\"], [\"type\", \"number\", \"placeholder\", \"\\u8ACB\\u8F38\\u5165\\u80A1\\u50F9\", \"formControlName\", \"dealPrice\", \"maxlength\", \"5\", 1, \"form-control\"], [\"type\", \"submit\", 1, \"btn\", \"submit-btn\", 3, \"disabled\", \"click\"], [1, \"mt-5\"], [1, \"custom-select\", \"col-md-2\", \"mr-3\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"dateRise\"], [\"value\", \"dateDrop\", \"selected\", \"\"], [\"value\", \"stockIdRise\"], [\"value\", \"stockIdDrop\"], [\"class\", \"btn col-md-2 switch-btn\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"col-md-2\", \"switch-btn\", 3, \"click\"], [1, \"table\", \"table-fixed\", \"table-hover\", \"mt-5\", \"mb-5\"], [1, \"list-unstyled\"], [4, \"ngFor\", \"ngForOf\"], [1, \"col-md-2\"], [1, \"col-md-1\"], [\"class\", \"col-md-2\", 4, \"ngIf\"], [\"class\", \"col-md-1\", 4, \"ngIf\"], [\"type\", \"button\", 1, \"fa-solid\", \"fa-trash\", 3, \"click\"], [\"type\", \"text\", \"minlength\", \"4\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"number\", \"min\", \"1\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"date\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"button\", 1, \"fa-solid\", \"fa-pen-to-square\", 3, \"click\"], [\"type\", \"button\", 1, \"fa-solid\", \"fa-floppy-disk\", 3, \"click\"], [3, \"value\"]],\n    template: function ShareholdingDetailsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r58 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelement(1, \"canvas\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2)(3, \"h1\");\n        i0.ɵɵtext(4);\n        i0.ɵɵpipe(5, \"number\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function ShareholdingDetailsComponent_Template_button_click_6_listener() {\n          i0.ɵɵrestoreView(_r58);\n\n          const _r4 = i0.ɵɵreference(13);\n\n          ctx.startAddShareholding();\n          return i0.ɵɵresetView(_r4.show());\n        });\n        i0.ɵɵtext(7, \"\\u65B0\\u589E\\u6301\\u80A1\\u660E\\u7D30\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(8, ShareholdingDetailsComponent_h1_8_Template, 2, 0, \"h1\", 4);\n        i0.ɵɵtemplate(9, ShareholdingDetailsComponent_div_9_Template, 12, 3, \"div\", 5);\n        i0.ɵɵtemplate(10, ShareholdingDetailsComponent_table_10_Template, 11, 1, \"table\", 6);\n        i0.ɵɵtemplate(11, ShareholdingDetailsComponent_table_11_Template, 19, 1, \"table\", 6);\n        i0.ɵɵelementStart(12, \"div\", 7, 8)(14, \"div\", 9)(15, \"div\", 10)(16, \"div\", 11)(17, \"h4\", 12);\n        i0.ɵɵtext(18, \"\\u65B0\\u589E\\u6301\\u80A1\\u660E\\u7D30\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"button\", 13);\n        i0.ɵɵlistener(\"click\", function ShareholdingDetailsComponent_Template_button_click_19_listener() {\n          i0.ɵɵrestoreView(_r58);\n\n          const _r4 = i0.ɵɵreference(13);\n\n          return i0.ɵɵresetView(_r4.hide());\n        });\n        i0.ɵɵelementStart(20, \"span\", 14);\n        i0.ɵɵtext(21, \"\\u00D7\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(22, \"div\", 15)(23, \"form\", 16);\n        i0.ɵɵlistener(\"ngSubmit\", function ShareholdingDetailsComponent_Template_form_ngSubmit_23_listener() {\n          return ctx.onAddShareholdingSubmit(ctx.form.value);\n        });\n        i0.ɵɵelementStart(24, \"div\", 17)(25, \"div\", 18)(26, \"span\", 19);\n        i0.ɵɵtext(27, \"\\u80A1\\u7968\\u4EE3\\u865F\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(28, \"input\", 20);\n        i0.ɵɵelementStart(29, \"datalist\", 21);\n        i0.ɵɵtemplate(30, ShareholdingDetailsComponent_option_30_Template, 2, 3, \"option\", 22);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(31, \"div\", 17)(32, \"div\", 18)(33, \"span\", 19);\n        i0.ɵɵtext(34, \"\\u4EA4\\u6613\\u65E5\\u671F\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(35, \"input\", 23);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"div\", 17)(37, \"div\", 18)(38, \"span\", 19);\n        i0.ɵɵtext(39, \"\\u80A1\\u6578\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(40, \"input\", 24);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(41, \"div\", 17)(42, \"div\", 18)(43, \"span\", 19);\n        i0.ɵɵtext(44, \"\\u80A1\\u50F9\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(45, \"input\", 25);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(46, \"button\", 26);\n        i0.ɵɵlistener(\"click\", function ShareholdingDetailsComponent_Template_button_click_46_listener() {\n          i0.ɵɵrestoreView(_r58);\n\n          const _r4 = i0.ɵɵreference(13);\n\n          return i0.ɵɵresetView(_r4.hide());\n        });\n        i0.ɵɵtext(47, \"\\u78BA\\u8A8D\");\n        i0.ɵɵelementEnd()()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵclassProp(\"d-none\", ctx.shareHoldingDetail.length === 0);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\\u7E3D\\u91D1\\u984D\\uFF1A$\", ctx.shareHoldingDetail.length === 0 ? 0 : i0.ɵɵpipeBind1(5, 10, ctx.totalAcount), \"\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.shareHoldingDetail.length === 0 && !ctx.isLoading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.shareHoldingDetail.length > 0 && !ctx.isLoading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.displayMode === \"sum\" && ctx.shareHoldingDetail.length > 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.displayMode === \"detail\" && ctx.shareHoldingDetail.length > 0);\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"formGroup\", ctx.form);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngForOf\", ctx.stocksInfo);\n        i0.ɵɵadvance(16);\n        i0.ɵɵproperty(\"disabled\", ctx.form.invalid);\n      }\n    },\n    dependencies: [i4.ɵNgNoValidate, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.MinLengthValidator, i4.MaxLengthValidator, i4.MinValidator, i4.NgModel, i5.NgForOf, i5.NgIf, i4.FormGroupDirective, i4.FormControlName, i6.ModalDirective, i5.DecimalPipe],\n    styles: [\".add-btn[_ngcontent-%COMP%]{width:300px;background-color:#c664ff;color:#fff}.submit-btn[_ngcontent-%COMP%]{background-color:#c664ff;color:#fff;width:100%}.switch-btn[_ngcontent-%COMP%]{color:#c664ff;border:2px solid #c664ff;font-weight:700}form[_ngcontent-%COMP%]{padding:10px 30px}table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:130px}\"]\n  });\n  return ShareholdingDetailsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}