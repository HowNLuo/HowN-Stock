{"ast":null,"code":"import { delay, tap, concatMap } from 'rxjs/operators';\nimport * as Chart from 'chart.js';\nimport * as moment from 'moment';\nimport * as _ from 'lodash';\nimport { of } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./../core/service/stock.service\";\nimport * as i2 from \"./../core/service/portfolio.service\";\nimport * as i3 from \"./../core/service/loading.service\";\nimport * as i4 from \"./../core/service/category.service\";\nimport * as i5 from \"../core/service/auth.service\";\nconst _c0 = [\"keywordForm\"];\nfunction HomeComponent_option_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const stockInfo_r7 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"value\", stockInfo_r7.stock_id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", stockInfo_r7.stock_id, \" \", stockInfo_r7.stock_name, \"\");\n  }\n}\nfunction HomeComponent_div_11_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"\\u8ACB\\u8F38\\u5165\\u4EE3\\u865F\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction HomeComponent_div_11_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"\\u8ACB\\u8F38\\u5165\\u6B63\\u78BA\\u683C\\u5F0F\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction HomeComponent_div_11_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"\\u67E5\\u7121\\u8CC7\\u6599\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction HomeComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26);\n    i0.ɵɵtemplate(1, HomeComponent_div_11_div_1_Template, 2, 0, \"div\", 11);\n    i0.ɵɵtemplate(2, HomeComponent_div_11_div_2_Template, 2, 0, \"div\", 11);\n    i0.ɵɵtemplate(3, HomeComponent_div_11_div_3_Template, 2, 0, \"div\", 11);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    const _r0 = i0.ɵɵreference(1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", _r0.touched && !_r0.controls.keyword.value);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", _r0.touched && _r0.controls.keyword.value && _r0.invalid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.dataNotFound && _r0.valid);\n  }\n}\nfunction HomeComponent_ng_container_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"h1\", 27);\n    i0.ɵɵtext(2, \" \\u8A72\\u80A1\\u65BC30\\u65E5\\u5167\\u7121\\u4EA4\\u6613\\u8CC7\\u8A0A \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction HomeComponent_ng_container_13_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"span\", 38);\n    i0.ɵɵlistener(\"mouseover\", function HomeComponent_ng_container_13_span_4_Template_span_mouseover_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r13.toggleHover(true));\n    })(\"mouseout\", function HomeComponent_ng_container_13_span_4_Template_span_mouseout_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r15.toggleHover(false));\n    })(\"click\", function HomeComponent_ng_container_13_span_4_Template_span_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r16 = i0.ɵɵnextContext(2);\n      const _r5 = i0.ɵɵreference(15);\n      ctx_r16.startClassifyPortfolio();\n      return i0.ɵɵresetView(_r5.show());\n    });\n    i0.ɵɵtext(1, \" \\u52A0\\u5165\\u6295\\u8CC7\\u7D44\\u5408 \");\n    i0.ɵɵelement(2, \"i\", 39);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r11 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"fa-regular\", !ctx_r11.isHovered)(\"fa-solid\", ctx_r11.isHovered || ctx_r11.isInPortfolios);\n  }\n}\nfunction HomeComponent_ng_container_13_tbody_83_tr_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\");\n    i0.ɵɵtext(13);\n    i0.ɵɵpipe(14, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵtext(16);\n    i0.ɵɵpipe(17, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"td\");\n    i0.ɵɵtext(19);\n    i0.ɵɵpipe(20, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"td\");\n    i0.ɵɵtext(22);\n    i0.ɵɵpipe(23, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"td\");\n    i0.ɵɵtext(25);\n    i0.ɵɵpipe(26, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const stock_r18 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(stock_r18.date);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(5, 9, stock_r18.Trading_Volume));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(8, 11, stock_r18.Trading_money));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(11, 13, stock_r18.open));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(14, 15, stock_r18.max));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(17, 17, stock_r18.min));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(20, 19, stock_r18.close));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(23, 21, stock_r18.spread));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(26, 23, stock_r18.Trading_turnover));\n  }\n}\nfunction HomeComponent_ng_container_13_tbody_83_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tbody\", 40);\n    i0.ɵɵtemplate(1, HomeComponent_ng_container_13_tbody_83_tr_1_Template, 27, 25, \"tr\", 41);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r12 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r12.oneMonthStockData);\n  }\n}\nfunction HomeComponent_ng_container_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 28)(2, \"h2\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, HomeComponent_ng_container_13_span_4_Template, 3, 4, \"span\", 29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 30);\n    i0.ɵɵelement(6, \"canvas\", 31);\n    i0.ɵɵelementStart(7, \"div\", 32)(8, \"div\", 33)(9, \"div\");\n    i0.ɵɵtext(10, \"\\u65E5\\u671F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\");\n    i0.ɵɵtext(14, \"\\u6210\\u4EA4\\u80A1\\u6578\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\");\n    i0.ɵɵtext(16);\n    i0.ɵɵpipe(17, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"div\");\n    i0.ɵɵtext(19, \"\\u6210\\u4EA4\\u91D1\\u984D\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"div\");\n    i0.ɵɵtext(21);\n    i0.ɵɵpipe(22, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\");\n    i0.ɵɵtext(24, \"\\u958B\\u76E4\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"div\");\n    i0.ɵɵtext(26);\n    i0.ɵɵpipe(27, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(28, \"div\");\n    i0.ɵɵtext(29, \"\\u6536\\u76E4\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"div\");\n    i0.ɵɵtext(31);\n    i0.ɵɵpipe(32, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"div\");\n    i0.ɵɵtext(34, \"\\u6700\\u9AD8\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(35, \"div\");\n    i0.ɵɵtext(36);\n    i0.ɵɵpipe(37, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(38, \"div\");\n    i0.ɵɵtext(39, \"\\u6700\\u4F4E\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"div\");\n    i0.ɵɵtext(41);\n    i0.ɵɵpipe(42, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(43, \"div\");\n    i0.ɵɵtext(44, \"\\u8CB7\\u8CE3\\u50F9\\u5DEE\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"div\");\n    i0.ɵɵtext(46);\n    i0.ɵɵpipe(47, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(48, \"div\");\n    i0.ɵɵtext(49, \"\\u6210\\u4EA4\\u7B46\\u6578\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(50, \"div\");\n    i0.ɵɵtext(51);\n    i0.ɵɵpipe(52, \"number\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(53, \"table\", 34)(54, \"thead\")(55, \"tr\")(56, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_56_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.sortColumn(\"date\"));\n    });\n    i0.ɵɵtext(57, \"\\u65E5\\u671F \");\n    i0.ɵɵelement(58, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(59, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_59_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r21.sortColumn(\"Trading_Volume\"));\n    });\n    i0.ɵɵtext(60, \"\\u6210\\u4EA4\\u80A1\\u6578 \");\n    i0.ɵɵelement(61, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(62, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_62_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r22.sortColumn(\"Trading_money\"));\n    });\n    i0.ɵɵtext(63, \"\\u6210\\u4EA4\\u91D1\\u984D \");\n    i0.ɵɵelement(64, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(65, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_65_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r23 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r23.sortColumn(\"open\"));\n    });\n    i0.ɵɵtext(66, \"\\u958B\\u76E4\\u50F9 \");\n    i0.ɵɵelement(67, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(68, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_68_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r24 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r24.sortColumn(\"max\"));\n    });\n    i0.ɵɵtext(69, \"\\u6700\\u9AD8\\u50F9 \");\n    i0.ɵɵelement(70, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(71, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_71_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r25 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r25.sortColumn(\"min\"));\n    });\n    i0.ɵɵtext(72, \"\\u6700\\u4F4E\\u50F9 \");\n    i0.ɵɵelement(73, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(74, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_74_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r26 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r26.sortColumn(\"close\"));\n    });\n    i0.ɵɵtext(75, \"\\u6536\\u76E4\\u50F9 \");\n    i0.ɵɵelement(76, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(77, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_77_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r27 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r27.sortColumn(\"spread\"));\n    });\n    i0.ɵɵtext(78, \"\\u8CB7\\u8CE3\\u50F9\\u5DEE \");\n    i0.ɵɵelement(79, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(80, \"th\", 35);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_13_Template_th_click_80_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r28 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r28.sortColumn(\"Trading_turnover\"));\n    });\n    i0.ɵɵtext(81, \"\\u6210\\u4EA4\\u7B46\\u6578 \");\n    i0.ɵɵelement(82, \"i\", 36);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(83, HomeComponent_ng_container_13_tbody_83_Template, 2, 1, \"tbody\", 37);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r4.title);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.isAuthenticated);\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate(ctx_r4.lastDayStockPrice.date);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(17, 12, ctx_r4.lastDayStockPrice.Trading_Volume));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(22, 14, ctx_r4.lastDayStockPrice.Trading_money));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(27, 16, ctx_r4.lastDayStockPrice.open));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(32, 18, ctx_r4.lastDayStockPrice.close));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(37, 20, ctx_r4.lastDayStockPrice.max));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(42, 22, ctx_r4.lastDayStockPrice.min));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(47, 24, ctx_r4.lastDayStockPrice.spread));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(52, 26, ctx_r4.lastDayStockPrice.Trading_turnover));\n    i0.ɵɵadvance(32);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.oneMonthStockData);\n  }\n}\nfunction HomeComponent_li_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r31 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 42)(1, \"div\", 43)(2, \"input\", 44);\n    i0.ɵɵlistener(\"change\", function HomeComponent_li_26_Template_input_change_2_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r31);\n      const category_r29 = restoredCtx.$implicit;\n      const ctx_r30 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r30.toggleCategory(category_r29.id, $event.target.checked));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"label\", 45);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const category_r29 = ctx.$implicit;\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"id\", category_r29.id)(\"checked\", ctx_r6.selectedCategories.includes(category_r29.id));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", category_r29.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", category_r29.categoryName, \" \");\n  }\n}\nconst _c1 = function (a0) {\n  return {\n    \"input-invalid\": a0\n  };\n};\nconst _c2 = function () {\n  return {\n    backdrop: \"static\"\n  };\n};\nexport let HomeComponent = /*#__PURE__*/(() => {\n  class HomeComponent {\n    // 搜尋欄位是否查無個股\n    get dataNotFound() {\n      return this.stocksInfo?.every(stockInfo => stockInfo.stock_id !== this.keywordForm.form.value.keyword);\n    }\n    // 所選股票是否加入至投資組合\n    get isInPortfolios() {\n      return this.portfolios ? this.portfolios.some(portfolio => portfolio.stockId === this.selectedStock.stock_id) : false;\n    }\n    // 是否異動過categories\n    get categoriesModified() {\n      return !_.isEqual(this.selectedCategories, this.cloneSelectedCategories);\n    }\n    constructor(stockService, portfolioService, loadingService, categoryService, authService) {\n      this.stockService = stockService;\n      this.portfolioService = portfolioService;\n      this.loadingService = loadingService;\n      this.categoryService = categoryService;\n      this.authService = authService;\n      this.oneMonthStockData = []; // 30天內股票成交資訊\n      this.portfolios = []; // 所有投資標的\n      this.selectedCategories = []; // 所選股票的類別(編輯)\n      this.sortStatus = {\n        date: 'drop',\n        Trading_Volume: 'drop',\n        Trading_money: 'drop',\n        open: 'drop',\n        close: 'drop',\n        max: 'drop',\n        min: 'drop',\n        spread: 'drop',\n        Trading_turnover: 'drop'\n      };\n      this.isAuthenticated = false;\n    }\n    ngOnInit() {\n      this.setDatalistOptions();\n      this.userSub = this.authService.user.subscribe(user => {\n        this.isAuthenticated = !!user;\n      });\n    }\n    ngOnDestroy() {\n      this.userSub.unsubscribe();\n    }\n    /** 設定台股代號選項 */\n    setDatalistOptions() {\n      this.loadingService.show();\n      this.stockService.getTaiwanStockInfo().subscribe(res => {\n        this.stocksInfo = res.data;\n        this.loadingService.hide();\n      });\n    }\n    /** 提交表單，查詢股票30天的交易資訊 */\n    onSearchClick() {\n      this.loadingService.show();\n      const startDate = moment(new Date().setMonth(new Date().getMonth() - 1)).format('YYYY-MM-DD');\n      const req = {\n        startDate: startDate,\n        stockId: this.keywordForm.form.value.keyword\n      };\n      this.selectedStock = this.stocksInfo.find(stockInfo => stockInfo.stock_id === this.keywordForm.form.value.keyword);\n      this.stockService.getTaiwanStockPrice(req).pipe(concatMap(res => {\n        this.lastDayStockPrice = res.data[res.data.length - 1];\n        this.oneMonthStockData = res.data.reverse();\n        this.title = this.selectedStock.stock_id + ' ' + this.selectedStock.stock_name;\n        return this.isAuthenticated ? this.portfolioService.getPortfolios() : of([]);\n      }), tap(res => {\n        if (res.length > 0) {\n          this.portfolios = res;\n          this.selectedPortfolio = res.find(portfolio => portfolio.stockId === this.keywordForm.form.value.keyword);\n          this.selectedCategories = res.find(portfolio => portfolio.stockId === this.selectedStock.stock_id)?.categories ?? [];\n          this.cloneSelectedCategories = _.cloneDeep(this.selectedCategories);\n        } else {\n          this.portfolios = [];\n          this.selectedPortfolio = null;\n          this.selectedCategories = [];\n          this.cloneSelectedCategories = [];\n        }\n        this.loadingService.hide();\n      }), delay(0) // 等HTML中的chart被生成\n      ).subscribe(() => {\n        this.drawChart();\n      });\n    }\n    /** 開始分類投資標的至各類別 */\n    startClassifyPortfolio() {\n      if (!this.categories) {\n        this.loadingService.show();\n        this.categoryService.getCategories().subscribe(res => {\n          this.categories = res;\n          this.loadingService.hide();\n        });\n      }\n    }\n    /** 提交分類結果 */\n    endClassifyPortfolio() {\n      if (this.categoriesModified) {\n        if (this.selectedCategories.length === 0) {\n          this.removeFromPortfolios();\n        } else {\n          this.cloneSelectedCategories = _.cloneDeep(this.selectedCategories);\n          const req = {\n            stockId: this.selectedStock.stock_id,\n            stockName: this.selectedStock.stock_name,\n            categories: this.selectedCategories\n          };\n          this.portfolioService.updatePortfolio(this.selectedStock.stock_id, req).pipe(concatMap(() => this.portfolioService.getPortfolios()), tap(res => this.portfolios = res)).subscribe();\n        }\n      }\n    }\n    /** 繪製折線圖 */\n    drawChart() {\n      const canvas = document.getElementById('chart');\n      if (this.chart) {\n        this.chart.destroy(); // 預防canvas重複渲染\n      }\n\n      if (canvas) {\n        const ctx = canvas.getContext('2d');\n        const xArray = [];\n        const yArray = [];\n        this.oneMonthStockData.forEach(stockData => {\n          xArray.push(stockData.date.slice(-5));\n          yArray.push(stockData.close);\n        });\n        const data = {\n          labels: xArray.reverse(),\n          datasets: [{\n            label: `30日股價歷史紀錄`,\n            data: yArray.reverse(),\n            fill: false,\n            borderColor: '#c664ff',\n            tension: 0.1\n          }]\n        };\n        const options = {};\n        this.chart = new Chart(ctx, {\n          type: 'line',\n          data: data,\n          options: options\n        });\n      }\n      ;\n    }\n    /** 懸停/離開 */\n    toggleHover(hovered) {\n      this.isHovered = hovered;\n    }\n    /** 排序欄位 */\n    sortColumn(columnName) {\n      if (this.sortStatus[columnName] === 'drop') {\n        this.sortStatus[columnName] = 'rise';\n        this.oneMonthStockData.sort((a, b) => {\n          if (columnName === 'date') {\n            const dateA = new Date(a.date);\n            const dateB = new Date(b.date);\n            return dateA.getTime() - dateB.getTime();\n          } else {\n            return a[columnName] - b[columnName];\n          }\n        });\n      } else {\n        this.sortStatus[columnName] = 'drop';\n        this.oneMonthStockData.sort((a, b) => {\n          if (columnName === 'date') {\n            const dateA = new Date(a.date);\n            const dateB = new Date(b.date);\n            return dateB.getTime() - dateA.getTime();\n          } else {\n            return b[columnName] - a[columnName];\n          }\n        });\n      }\n    }\n    /** 勾選類別 */\n    toggleCategory(categoryId, isChecked) {\n      if (isChecked) {\n        this.selectedCategories.push(categoryId);\n      } else {\n        this.selectedCategories = this.selectedCategories.filter(category => category !== categoryId);\n      }\n      ;\n    }\n    /** 還原選取的類別 */\n    revertCategory() {\n      this.selectedCategories = _.cloneDeep(this.cloneSelectedCategories);\n    }\n    /** 從投資組合中移除 */\n    removeFromPortfolios() {\n      this.portfolioService.deletePortfolio(this.selectedStock.stock_id).pipe(concatMap(() => this.portfolioService.getPortfolios()), tap(res => {\n        this.portfolios = res;\n        this.selectedPortfolio = null;\n        this.selectedCategories = [];\n        this.cloneSelectedCategories = [];\n      })).subscribe();\n    }\n    static #_ = this.ɵfac = function HomeComponent_Factory(t) {\n      return new (t || HomeComponent)(i0.ɵɵdirectiveInject(i1.StockService), i0.ɵɵdirectiveInject(i2.PortfolioService), i0.ɵɵdirectiveInject(i3.LoadingService), i0.ɵɵdirectiveInject(i4.CategoryService), i0.ɵɵdirectiveInject(i5.AuthService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: HomeComponent,\n      selectors: [[\"app-home\"]],\n      viewQuery: function HomeComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.keywordForm = _t.first);\n        }\n      },\n      decls: 31,\n      vars: 11,\n      consts: [[1, \"row\", \"mt-5\", 3, \"ngSubmit\"], [\"keywordForm\", \"ngForm\"], [1, \"input-group\", \"col-md-4\"], [1, \"input-group-prepend\"], [1, \"input-group-text\"], [1, \"fas\", \"fa-search\"], [\"type\", \"text\", \"placeholder\", \"\\u641C\\u5C0B\\u53F0\\u80A1\\u4EE3\\u865F/\\u540D\\u7A31\", \"list\", \"keyword\", \"name\", \"keyword\", \"ngModel\", \"\", \"required\", \"\", \"pattern\", \"^[A-Z0-9]*$\", \"minlength\", \"4\", \"maxlength\", \"6\", \"autocomplete\", \"off\", 1, \"form-control\", 3, \"ngClass\", \"focus\"], [\"id\", \"keyword\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"col-md-1\", \"search-button\", 3, \"disabled\"], [\"class\", \"mt-3 hint-box\", 4, \"ngIf\"], [4, \"ngIf\"], [\"bsModal\", \"\", \"tabindex\", \"-1\", \"role\", \"dialog\", \"aria-labelledby\", \"dialog-sizes-name2\", 1, \"modal\", \"fade\", 3, \"config\"], [\"addPortfolio\", \"bs-modal\"], [1, \"modal-dialog\", \"modal-sm\"], [1, \"modal-content\"], [1, \"modal-header\"], [\"id\", \"dialog-sizes-name2\", 1, \"modal-title\", \"pull-left\"], [\"type\", \"button\", \"aria-label\", \"Close\", 1, \"close\", \"pull-right\", 3, \"click\"], [\"aria-hidden\", \"true\"], [1, \"modal-body\"], [1, \"list-group\", \"mb-3\"], [\"class\", \"list-group-item\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"submit-button\", 3, \"click\"], [\"type\", \"submit\", 1, \"btn\", \"ml-3\", \"remove-button\", 3, \"click\"], [3, \"value\"], [1, \"mt-3\", \"hint-box\"], [1, \"mt-5\", \"mb-3\"], [1, \"d-flex\", \"mt-5\", \"justify-content-between\", \"align-items-end\"], [\"type\", \"button\", 3, \"mouseover\", \"mouseout\", \"click\", 4, \"ngIf\"], [1, \"row\", \"mt-5\"], [\"id\", \"chart\", 1, \"col-md-6\"], [1, \"col-md-6\", \"align-self-center\"], [1, \"latest-stock-detail\"], [1, \"table\", \"table-fixed\", \"table-hover\", \"mt-5\"], [3, \"click\"], [1, \"fa-solid\", \"fa-sort\"], [\"class\", \"list-unstyled\", 4, \"ngIf\"], [\"type\", \"button\", 3, \"mouseover\", \"mouseout\", \"click\"], [1, \"fa-star\"], [1, \"list-unstyled\"], [4, \"ngFor\", \"ngForOf\"], [1, \"list-group-item\"], [1, \"form-check\"], [\"type\", \"checkbox\", 1, \"form-check-input\", 3, \"id\", \"checked\", \"change\"], [1, \"form-check-label\", 3, \"for\"]],\n      template: function HomeComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r32 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"form\", 0, 1);\n          i0.ɵɵlistener(\"ngSubmit\", function HomeComponent_Template_form_ngSubmit_0_listener() {\n            return ctx.onSearchClick();\n          });\n          i0.ɵɵelementStart(2, \"div\", 2)(3, \"div\", 3)(4, \"span\", 4);\n          i0.ɵɵelement(5, \"i\", 5);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(6, \"input\", 6);\n          i0.ɵɵlistener(\"focus\", function HomeComponent_Template_input_focus_6_listener() {\n            i0.ɵɵrestoreView(_r32);\n            const _r0 = i0.ɵɵreference(1);\n            return i0.ɵɵresetView(_r0.reset());\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"datalist\", 7);\n          i0.ɵɵtemplate(8, HomeComponent_option_8_Template, 2, 3, \"option\", 8);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(9, \"button\", 9);\n          i0.ɵɵtext(10, \"\\u67E5\\u8A62\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(11, HomeComponent_div_11_Template, 4, 3, \"div\", 10);\n          i0.ɵɵtemplate(12, HomeComponent_ng_container_12_Template, 3, 0, \"ng-container\", 11);\n          i0.ɵɵtemplate(13, HomeComponent_ng_container_13_Template, 84, 28, \"ng-container\", 11);\n          i0.ɵɵelementStart(14, \"div\", 12, 13)(16, \"div\", 14)(17, \"div\", 15)(18, \"div\", 16)(19, \"h4\", 17);\n          i0.ɵɵtext(20, \"\\u52A0\\u5165\\u6295\\u8CC7\\u7D44\\u5408\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"button\", 18);\n          i0.ɵɵlistener(\"click\", function HomeComponent_Template_button_click_21_listener() {\n            i0.ɵɵrestoreView(_r32);\n            const _r5 = i0.ɵɵreference(15);\n            ctx.revertCategory();\n            return i0.ɵɵresetView(_r5.hide());\n          });\n          i0.ɵɵelementStart(22, \"span\", 19);\n          i0.ɵɵtext(23, \"\\u00D7\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(24, \"form\", 20)(25, \"ul\", 21);\n          i0.ɵɵtemplate(26, HomeComponent_li_26_Template, 5, 4, \"li\", 22);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(27, \"button\", 23);\n          i0.ɵɵlistener(\"click\", function HomeComponent_Template_button_click_27_listener() {\n            i0.ɵɵrestoreView(_r32);\n            const _r5 = i0.ɵɵreference(15);\n            ctx.endClassifyPortfolio();\n            return i0.ɵɵresetView(_r5.hide());\n          });\n          i0.ɵɵtext(28, \"\\u78BA\\u8A8D\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(29, \"button\", 24);\n          i0.ɵɵlistener(\"click\", function HomeComponent_Template_button_click_29_listener() {\n            i0.ɵɵrestoreView(_r32);\n            const _r5 = i0.ɵɵreference(15);\n            ctx.removeFromPortfolios();\n            return i0.ɵɵresetView(_r5.hide());\n          });\n          i0.ɵɵtext(30, \"\\u79FB\\u9664\");\n          i0.ɵɵelementEnd()()()()();\n        }\n        if (rf & 2) {\n          const _r0 = i0.ɵɵreference(1);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(8, _c1, _r0.touched && (_r0.invalid || ctx.dataNotFound) && ctx.oneMonthStockData.length === 0));\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.stocksInfo);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"disabled\", _r0.invalid || ctx.dataNotFound);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.oneMonthStockData.length === 0);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", _r0.submitted && ctx.oneMonthStockData.length === 0);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.oneMonthStockData.length > 0);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"config\", i0.ɵɵpureFunction0(10, _c2));\n          i0.ɵɵadvance(12);\n          i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n        }\n      },\n      styles: [\".input-group-text[_ngcontent-%COMP%]{background-color:#eed1ff}.input-invalid[_ngcontent-%COMP%]{border:1px solid red}.hint-box[_ngcontent-%COMP%]{color:red;font-weight:bolder}.latest-stock-detail[_ngcontent-%COMP%]{display:grid;grid-template-rows:repeat(5,1fr);grid-template-columns:repeat(4,1fr);gap:20px;border:2px solid #c664ff;padding:10px}.latest-stock-detail[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2){grid-area:1/2/2/5}span[_ngcontent-%COMP%]   .fa-solid[_ngcontent-%COMP%]{color:#c664ff}.fa-sort[_ngcontent-%COMP%]{display:none}thead[_ngcontent-%COMP%]{background-color:#c664ff}tbody[_ngcontent-%COMP%]{background-color:#eed1ff}th[_ngcontent-%COMP%]:hover{cursor:pointer}th[_ngcontent-%COMP%]:hover > .fa-sort[_ngcontent-%COMP%]{display:inline-block}.search-button[_ngcontent-%COMP%], .submit-button[_ngcontent-%COMP%], td[_ngcontent-%COMP%]:hover{background-color:#c664ff;color:#fff}.remove-button[_ngcontent-%COMP%]{border:1px solid #c664ff;color:#c664ff}label[_ngcontent-%COMP%]{width:100%}\"]\n    });\n  }\n  return HomeComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}